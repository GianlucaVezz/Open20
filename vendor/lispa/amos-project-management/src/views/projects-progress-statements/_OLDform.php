<?php

use lispa\amos\core\forms\ActiveForm;
use lispa\amos\core\forms\CloseSaveButtonWidget;
use lispa\amos\core\forms\Tabs;
use lispa\amos\core\forms\TextEditorWidget;
use lispa\amos\projectmanagement\models\ProjectsProgressStatementsType;
use lispa\amos\projectmanagement\Module;
use kartik\builder\Form;
use kartik\select2\Select2;

/**
 * @var yii\web\View $this
 * @var lispa\amos\projectmanagement\models\ProjectsProgressStatements $model
 * @var yii\widgets\ActiveForm $form
 */
$task = $model->projectsTask;
$activity = $model->projectsTask->projectsActivities;
$upRef = \lispa\amos\admin\models\UserProfile::find()->andWhere(['user_id' => $task->getUserResponsibleId()])->one();
?>

<?php $form = ActiveForm::begin(); ?>
<?php
try {
    echo \lispa\amos\core\forms\WorkflowTransitionWidget::widget([
        'form' => $form,
        'model' => $model,
        'workflowId' => \lispa\amos\projectmanagement\models\ProjectsProgressStatements::PROJECTSACTIVITYPROGRESS_WORKFLOW,
        'classDivIcon' => 'pull-left',
        'classDivMessage' => 'pull-left message',
        'viewWidgetOnNewRecord' => true
    ]);
} catch (Exception $e) {
    pr($e->getMessage() . ' L:' . $e->getLine(), 'ERROR');
//    pr($e->getTraceAsString());
}
?>
    <div class="projects-progress-statements-form col-xs-12 nop">

        <div class="col-lg-12 col-sm-12">
            <h3><?= Module::t('amosproject_management', 'Activity') ?></h3>
        </div>
        <div class="col-lg-12 col-sm-12">
            <div class="col-lg-6 col-sm-6 "><?= Module::t('amosproject_management', 'WP') ?></div>
            <div class="col-lg-6 col-sm-6 bold"><?= $task->name ?></div>
        </div>
        <div class="col-lg-12 col-sm-12">
            <div class="col-lg-6 col-sm-6 "><?= Module::t('amosproject_management', 'Description') ?></div>
            <div class="col-lg-6 col-sm-6 bold"><?= $task->description ?></div>
        </div>
        <div class="col-lg-12 col-sm-12">
            <div class="col-lg-6 col-sm-6 "><?= Module::t('amosproject_management', 'Start Date') ?></div>
            <div class="col-lg-6 col-sm-6 bold"><?= Yii::$app->formatter->asDate($task->start_date) ?></div>
        </div>
        <div class="col-lg-12 col-sm-12">
            <div class="col-lg-6 col-sm-6 "><?= Module::t('amosproject_management', 'End Date') ?></div>
            <div class="col-lg-6 col-sm-6 bold"><?= Yii::$app->formatter->asDate($task->end_date) ?></div>
        </div>
        <div class="col-lg-12 col-sm-12">
            <div class="col-lg-6 col-sm-6 "><?= Module::t('amosproject_management', 'Responsible') ?></div>

            <div class="col-lg-6 col-sm-6 bold"><?= $upRef->getNomeCognome() ?></div>
        </div>

        <div class="col-lg-12 col-sm-12">
            <?= // generated by schmunk42\giiant\generators\crud\providers\core\RelationProvider::activeField
            $form->field($model, 'projects_progress_statements_type_id')->widget(Select2::className(), [
                'data' => \yii\helpers\ArrayHelper::map(ProjectsProgressStatementsType::find()->all(), 'id', 'nameTranslate'),
                'options' =>
                    [
                        'placeholder' => Module::t('amosproject_management', 'Select...')
                    ]
            ]);
            ?>
        </div>
        <div class="col-lg-12 col-sm-12">
            <?= $form->field($model, 'note')->widget(TextEditorWidget::className(), [
                'clientOptions' => [
                    'placeholder' => Module::t('amosproject_management', 'Note'),
                    'lang' => substr(Yii::$app->language, 0, 2)
                ]
            ]) ?>
        </div>
        <div class="clearfix"></div>
        <?php $this->endBlock(); ?>

        <?php $itemsTab[] = [
            'label' => Yii::t('cruds', 'DEFAULT'),
            'content' => $this->blocks['default'],
        ];
        ?>

        <?php
        try {
            echo Tabs::widget(
                [
                    'encodeLabels' => false,
                    'items' => $itemsTab
                ]
            );
        } catch (Exception $e) {
            pr($e->getMessage());
        }
        ?>
        <?php
        try {
            echo CloseSaveButtonWidget::widget(['model' => $model]);
        } catch (Exception $e) {
            pr($e->getMessage());
        }
        ?>

    </div>
<?php ActiveForm::end(); ?>